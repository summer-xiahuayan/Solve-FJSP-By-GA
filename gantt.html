<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flow Shop Scheduling Gantt Chart</title>
    <link rel="stylesheet" href="dhtmlxgantt.css" type="text/css">
    <script src="dhtmlxgantt.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #gantt_here {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    
	
<div id="gantt_here" style="width: 100%;"></div>


<script>


	gantt.config.duration_unit = "day"; // Set duration unit to seconds

    gantt.config.scale_height = 60; // Set scale height for each machine

    gantt.config.row_height = 60; // Set row height for each task

    gantt.config.min_column_width = 50; // Minimum width for the columns

	//gantt.config.readonly = true;
    var ganttData = [[[1, 0, 5, 1], [9, 5, 6, 2], [5, 6, 7, 2], [2, 7, 9, 3], [9, 9, 11, 4], [6, 11, 13, 2], [2, 15, 16, 5], [8, 17, 18, 3], [3, 19, 20, 3], [1, 20, 21, 4], [6, 36, 37, 5]], [[2, 0, 6, 1], [3, 6, 12, 1], [5, 12, 18, 3], [8, 18, 24, 4], [4, 24, 30, 2], [6, 30, 36, 4], [4, 36, 37, 4], [9, 37, 43, 6]], [[8, 0, 4, 1], [2, 6, 7, 2], [10, 7, 11, 2], [7, 11, 15, 3], [3, 15, 19, 2], [5, 19, 23, 4], [6, 23, 27, 3], [1, 27, 28, 5], [7, 28, 29, 5], [4, 30, 31, 3], [9, 31, 35, 5]], [[7, 4, 6, 2], [9, 6, 9, 3], [2, 9, 15, 4], [10, 18, 24, 5], [5, 24, 30, 5], [10, 30, 32, 6], [8, 32, 38, 5], [1, 38, 41, 6], [6, 41, 43, 6]], [[5, 0, 3, 1], [1, 5, 8, 2], [10, 11, 14, 3], [7, 15, 16, 4], [3, 26, 31, 5]], [[9, 0, 1, 1], [10, 1, 3, 1], [7, 3, 4, 1], [4, 4, 9, 1], [6, 9, 11, 1], [8, 11, 17, 2], [10, 17, 18, 4], [1, 18, 20, 3], [3, 20, 26, 4], [5, 30, 36, 6], [4, 37, 39, 5]]];



    var colors = ["#15b01a", "#0343df", "#e50000", "#f97306", "#653700", "#929591", "#00ffff", "#6e750e",

                  "#a03623", "#fac205", "#bf9005", "#029386", "#214761", "#ffd1df", "#e6daa6"];



    gantt.init("gantt_here");

    gantt.parse({

        data: (function() {

            var tasks = [];

            var taskIndex = 1;
			
			for (var m = 0; m < ganttData.length; m++) { // Iterate over machines
				var end_job = ganttData[m][ganttData[m].length-1];
					var star_job=ganttData[m][0];
					var dur_time=end_job[2]-star_job[1]
					var m_index=m+1
					
				var startDate = new Date(); // 获取当前日期和时间
				//var startDate = new Date();

				var startDays = star_job[1]; // 假设 job[1] 是要添加的天数
				function addDays(startDate, days) {

    var result = new Date(startDate);

    result.setDate(result.getDate() + days);
	console.log(result)

    return result;

}

				var newStartDate = addDays(startDate, startDays);



				// 将 Date 对象转换为 ISO 格式字符串（YYYY-MM-DD）

				//var isoStartDate = startDate.toISOString().split('T')[0];



				//console.log(isoStartDate); // 输出格式为 "YYYY-MM-DD" 的字符串
					
                    
                    tasks.push({

                        id: m+1,

                        text: "M" +m_index,

                        start_date:newStartDate,//job[1],

                        duration: dur_time, // Convert days to seconds

                        parent: 0,

                        progress: 0.0,

                        open: true,
						render: 'split',

                        color: '#666'// Job color

                    });
					taskIndex++
            } 
			
			



            for (var m = 0; m < ganttData.length; m++) { // Iterate over machines

                for (var j = 0; j < ganttData[m].length; j++) { // Iterate over jobs

                    var job = ganttData[m][j];
				
                    // 假设 startDate 是一个 Date 对象，days 是要添加的天数

function addDays(startDate, days) {

    var result = new Date(startDate);

    result.setDate(result.getDate() + days);
	console.log(result)

    return result;

}



// 使用示例

var startDate = new Date();

var jobDays = job[1]; // 假设 job[1] 是要添加的天数

var newStartDate = addDays(startDate, jobDays);



// 然后将 newStartDate 用作任务的开始日期
var op="|T"+job[3]+'|'

tasks.push({

    id: taskIndex++,

    text: "J" + job[0]+op,

    start_date: newStartDate,

    duration: job[2] - job[1],

    parent: m + 1,

    progress: 0.0,

    open: true,

    color: colors[(job[0] - 1) % colors.length]

});

                }

            }

            return tasks;

        })(),

        links: []

    });



    // Set date format
	//gantt.config.start_date = this.nowDate.format('YYYY-MM-DD')
	//gantt.config.end_date = this.newDate.format('YYYY-MM-DD')

//    gantt.config.date_format = "%Y-%m-%d %H:%i:%s"; // Include seconds in date format
	//gantt.resize();

    

    // Adjust the view

    gantt.attachEvent("onGanttReady", function() {

        gantt.showDate(gantt.date.add(gantt.date.min, gantt.date.day, 1));

        gantt.showDate(gantt.date.add(gantt.date.max, gantt.date.day, 10));

    });

</script>

</body>
</html>
